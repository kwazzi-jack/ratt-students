% ratt-handbook.sty
\NeedsTeXFormat{LaTeX2e}
\ProvidesPackage{ratt-handbook}[Custom style for RATT Student Handbook]

% ========== Base Packages ==========
\RequirePackage[utf8]{inputenc}
\RequirePackage{graphicx}
\RequirePackage{hyperref}
\RequirePackage{fancyhdr}
\RequirePackage{geometry}
\RequirePackage{xcolor}
\RequirePackage{titlesec}
\RequirePackage{fontspec}
\RequirePackage{setspace}
\RequirePackage{tikz}
\usetikzlibrary{calc}
\RequirePackage{minted}

% ========== Color Scheme ==========
\definecolor{ratt-primary}{HTML}{802474}
\definecolor{ratt-secondary}{HTML}{5A1A4D}
\definecolor{ratt-accent}{HTML}{E0E0E0}
\definecolor{section-gray}{HTML}{4A4A4A}

% ========== Font Configuration ==========
\setmainfont{Fira Sans}[
    Path = ../resources/fonts/,
    Extension = .ttf,
    UprightFont = *-Regular,
    BoldFont = *-Bold,
    ItalicFont = *-Italic,
    BoldItalicFont = *-BoldItalic
]

\setsansfont{Fira Sans}[
    Path = ../resources/fonts/,
    Extension = .ttf,
    UprightFont = *-Regular,
    BoldFont = *-Bold,
    ItalicFont = *-Italic,
    BoldItalicFont = *-BoldItalic
]

\setmonofont{Fira Code}[
    Path = ../resources/fonts/,
    Extension = .ttf,
    UprightFont = *-Regular,
    BoldFont = *-Bold,
]

% ========== Page Layout ==========
\geometry{
    a4paper,
    top=30mm,
    bottom=30mm,
    left=25mm,
    right=25mm,
    headheight=15mm,
    footskip=10mm
}

\setlength{\parskip}{1em}
\setlength{\parindent}{0pt}

% ========== Header/Footer Design ==========
\pagestyle{fancy}
\fancyhf{}
\renewcommand{\headrulewidth}{0pt}

% Modern header with colored bar
\fancyhead[L]{
    \begin{tikzpicture}[remember picture,overlay]
        \node[anchor=east] at
            ($(current page.north east)+(-15mm,-10mm)$) {\includegraphics[height=8mm]{logos/ratt-logo.png}};
        \draw [ratt-secondary, line width=0.5mm]
            ($(current page.north west)+(15mm,-20mm)$) --
            ($(current page.north east)+(-15mm,-20mm)$);
    \end{tikzpicture}
}

\fancyfoot[C]{
    \begin{tikzpicture}[remember picture,overlay]
        \fill[color=ratt-accent] (current page.south west) rectangle
            ($(current page.south west)+(50mm,2mm)$);
    \end{tikzpicture}
    \color{section-gray}\thepage
}

% ========== Title Page Redesign ==========
\makeatletter
\renewcommand{\maketitle}{
    \begin{titlepage}
        \centering

        % RATT Logo
        \includegraphics[width=0.5\textwidth]{logos/ratt-logo.png}
        \vfill
        \scalebox{2}{
            \fontsize{32pt}{0pt}\selectfont
            \color{ratt-primary}
            \Huge\sffamily\bfseries
            \begin{tabular}{c}
                \@title
            \end{tabular}
        }

        \vfill

        % Institution Logos
        \includegraphics[height=20mm]{logos/rhodes-logo-1.png}\hspace{20mm}
        \includegraphics[height=20mm]{logos/sarao-logo.png}

        \vspace{15mm}

        {\color{ratt-secondary}\Large\sffamily Radio Astronomy Techniques \& Technologies}

        \vspace{5mm}

        {\color{ratt-secondary}\large\sffamily Rhodes University\\\@date}
    \end{titlepage}
}

% ========== Section Styling ==========
\titleformat{\section}
    {% format
        \sffamily\Large\bfseries\color{ratt-primary}
    }
    {% label
        \thesection
    }
    {% sep
        3em
    }
    {% before-code
    }
    [% after-code
        \vspace{1em}
    ]

\titleformat{\subsection}
    {\sffamily\large\bfseries\color{ratt-secondary}}
    {\thesubsection}
    {2em}
    {}
    [\vspace{-0.5em}]

\titleformat{\subsubsection}
    {\sffamily\normalsize\bfseries\color{ratt-primary}} %
    {}
    {0pt}
    {}
    [\vspace{-0.5em}]

% ========== Hyperlink Styling ==========
\hypersetup{
    colorlinks=true,
    linkcolor=ratt-primary,
    urlcolor=ratt-secondary,
    citecolor=ratt-secondary
}

% ========== Custom Elements ==========
\newcommand{\rattbox}[1]{
    \begin{center}
        \begin{tikzpicture}
            \node[rectangle,
                  rounded corners=3mm,
                  draw=ratt-primary,
                  line width=1pt,
                  inner ysep=10pt,
                  inner xsep=15pt,
                  fill=ratt-accent!20]
                {\parbox{0.9\linewidth}{#1}};
        \end{tikzpicture}
    \end{center}
}

% =========- Line Spacing -=========-
\onehalfspacing

% ========= Custom Code Blocks ======

\setminted{
  fontsize=\small,
  frame=single,
  framesep=10pt,
  bgcolor=ratt-primary!20,
  baselinestretch=1,
  numbersep=5pt,
  gobble=0,
  tabsize=4,
  breaklines,
}
